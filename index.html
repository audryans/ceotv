<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Private Stream</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDK -->
<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBxuc3suKfedfLcBIHNkfNQ9kUlZr2y1FQ",
    authDomain: "twitch-user-access.firebaseapp.com",
    projectId: "twitch-user-access",
    storageBucket: "twitch-user-access.firebasestorage.app",
    messagingSenderId: "370819036531",
    appId: "1:370819036531:web:b6a2590eaec92e9394c106"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Two-step access functions
  const STREAM_PASSWORD = "1234"; // Change this to your real password

  window.submitViewerData = async function() {
    const fullName = document.getElementById("fullName").value.trim();
    const phone = document.getElementById("phone").value.trim();

    if (!fullName || !phone) {
      alert("Please fill all fields");
      return;
    }

    try {
      // Save to Firestore
      await addDoc(collection(db, "viewers"), {
        full_name: fullName,
        phone: phone,
        timestamp: serverTimestamp()
      });

      // Hide registration form & show password form
      document.getElementById("registrationCard").style.display = "none";
      document.getElementById("passwordCard").style.display = "block";

    } catch (err) {
      alert("Error saving details: " + err);
    }
  };

  window.unlockStream = function() {
    const input = document.getElementById("passwordInput").value;
    if (input === STREAM_PASSWORD) {
      document.getElementById("lockScreen").style.display = "none";
      document.getElementById("streamWrap").style.display = "flex";
    } else {
      alert("Incorrect password");
    }
  };
</script>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: radial-gradient(circle at top, #020202, #000);
  font-family: Arial, sans-serif;
  color: #00ffe7;
}

/* LOCK SCREEN */
#lockScreen {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.96);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.lock-card {
  padding: 32px;
  border-radius: 16px;
  border: 2px solid #00ffe7;
  box-shadow: 0 0 30px #00ffe7, 0 0 60px #ff00ff;
  text-align: center;
  max-width: 380px;
  width: 92%;
}

.lock-card h2 {
  color: #ff00ff;
  text-shadow: 0 0 15px #ff00ff;
  margin-bottom: 10px;
}

.lock-card input {
  width: 100%;
  padding: 12px;
  margin-top: 14px;
  border-radius: 8px;
  background: transparent;
  border: 2px solid #00ffe7;
  color: #00ffe7;
  font-size: 16px;
  text-align: center;
}

.lock-card button {
  margin-top: 16px;
  padding: 12px;
  width: 100%;
  border-radius: 8px;
  border: none;
  background: #00ffe7;
  color: #000;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 20px #00ffe7;
}

.lock-card p {
  font-size: 14px;
  opacity: 0.85;
  margin-top: 12px;
}

.lock-card a {
  color: #25D366;
  font-weight: bold;
  text-decoration: none;
  text-shadow: 0 0 10px #25D366;
}

.lock-card a:hover {
  text-decoration: underline;
}

.stream-wrap {
  display: none;
  padding: 10px;
  justify-content: center;
}

.stream-frame {
  width: 95%;
  max-width: 1200px;
  border-radius: 16px;
  overflow: hidden;
  border: 2px solid #00ffe7;
  box-shadow: 0 0 20px #00ffe7, 0 0 50px #ff00ff;
}

iframe {
  width: 100%;
  height: 650px;
  border: none;
}
</style>
</head>

<body>

<!-- LOCK SCREEN WITH REGISTRATION + PASSWORD -->
<div id="lockScreen">
  <!-- Step 1: Registration -->
  <div class="lock-card" id="registrationCard">
    <h2>Enter Your Details</h2>
    <input type="text" id="fullName" placeholder="Full Name" required>
    <input type="tel" id="phone" placeholder="Phone Number" required>
    <button onclick="submitViewerData()">Next</button>
    <p>Need help? <a href="https://wa.me/254725820123" target="_blank">ðŸ’¬ Chat on WhatsApp</a></p>
  </div>

  <!-- Step 2: Password -->
  <div class="lock-card" id="passwordCard" style="display:none;">
    <h2>Enter Stream Password</h2>
    <input type="password" id="passwordInput" placeholder="Access Password">
    <button onclick="unlockStream()">Unlock Stream</button>
    <p>Need help? <a href="https://wa.me/254725820123" target="_blank">ðŸ’¬ Chat on WhatsApp</a></p>
  </div>
</div>

<!-- STREAM -->
<div class="stream-wrap" id="streamWrap">
  <div class="stream-frame">
    <iframe
      src="https://player.twitch.tv/?channel=sportpesaleaguetv&parent=audryans.github.io"
      allowfullscreen>
    </iframe>
  </div>
</div>

</body>
</html>
